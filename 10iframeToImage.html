<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <style>
            body{
                max-width: 700px;
                margin: 0 auto;
                padding: 2rem;}
        </style>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    </head>
    <body>
        <div><iframe src="https://google.com"></iframe></div>
        <div><iframe height="auto" style="width: 300px;" scrolling="no" title="Screwing a little ;)" src="https://codepen.io/oshimamasara/embed/qBOjzPz?height=265&theme-id=dark&default-tab=result" frameborder="no" allowtransparency="true" allowfullscreen="true"> See the Pen <a href='https://codepen.io/oshimamasara/pen/qBOjzPz'>Screwing a little ;)</a> by Takayuki Oshima(<a href='https://codepen.io/oshimamasara'>@oshimamasara</a>) on <a href='https://codepen.io'>CodePen</a>.</iframe></div>
        <div><iframe width="300" height="auto" src="https://www.youtube.com/embed/MF8ukTZRRB4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
        <div><iframe src="https://wordpress.com"></iframe></div>
        <script>
            var timepast=false; 
            var links = [];
            
            setTimeout(function() {  // 0.5s 経ったらトリガー
                timepast = true;
            },500);

            //var counter = 0;
            var x = 0;
            $('iframe').each(function(){
                //console.log(this.src);
                this.onload = function(){
                    
                    if(timepast) {
                        //console.log(String(counter)+"番目のループ"); // ループ 4回してからログが読み込まれる様子
                        console.log(this.src + "\n**** 3 It's PROBABLY OK");
                        console.log(timepast);
                    }
                    else{
                        //console.log(String(counter)+"番目のループ");
                        console.log(this.src + "\n**** 4 It's PROBABLY NOT OK");
                        console.log(timepast);
                        this.remove();
                        var img = '<img src="https://pythonchannel.com/static/images/twitter_search_app/17.jpg" style="max-width:150px;float:left"' + 'alt="' + String(x) + '番目のiframeが × なので代替画像"><p style="height:150px;padding:1.5rem;font-size:0.8rem;">CodePen.io などの外部サイト読み込みに失敗！<br>こちらの<a href="' + this.src + '">リンク</a>より内容確認お願いします。</p>';
                        //$("div").html(img); // 全部の div 内の iframe が変わる
                        $("div").eq(x).html(img);
                        console.log('⭐️Replace!'); // iframeの数だけ画像が出る
                    }
                    console.log('No:'+String(x));  // 順番どおり
                    //console.log('No--' + String(counter));  // 常に 4
                    x++;
                };
                
                document.body.appendChild(this);
                //console.log(counter);
                //counter++;
            })
        </script>
    </body>
</html>